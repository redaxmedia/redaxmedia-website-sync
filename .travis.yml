language: php

php: 7.2

addons:
 apt:
  packages:
  - lftp

before_install:
- composer global require hirak/prestissimo

install:
- composer install
- nvm install 14
- npm install --global grunt-cli
- npm install
- cd vendor/redaxmedia/redaxmedia-template && npm install && cd -
- cd vendor/redaxscript/redaxscript && npm install && cd -

script:
- replace 'vendor/redaxscript' '../../redaxscript' -- vendor/redaxmedia/redaxmedia-template/templates/redaxmedia/assets/styles/_redaxmedia.css
- grunt build --gruntfile vendor/redaxmedia/redaxmedia-template/gruntfile.js
- grunt build --gruntfile vendor/redaxscript/redaxscript/gruntfile.js
- grunt
- grunt config
- grunt lock

after_success:
- grunt deploy

notifications:
 email:
 - info@redaxmedia.com
